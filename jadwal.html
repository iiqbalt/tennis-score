<!DOCTYPE html>

<head>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!-- will only load if it's being hosted by nodejs' -->
    <script src="/socket.io/socket.io.js"></script>
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.45/moment-timezone.min.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/locale/id.min.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment.min.js"
        integrity="sha512-hUhvpC5f8cgc04OZb55j0KNGh4eh7dLxd/dPSJ5VyzqDWxsayYbojWyl5Tkcgrmb/RVKCRJI1jNlRbVP4WWC4w=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->

    <link rel="stylesheet" type="text/css" href="/css/index.css" />

    <title>Tennis Score | Jadwal Pertandingan</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        .btn {
            margin: 3px;
        }
    </style>
</head>

<body>
    <div id="app">
        <h3 style="padding: 10px 20px;">Admin | Jadwal Pertandingan</h3>
        
        <div class="modal fade" id="modal-new" aria-modal="true" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Tambah Jadwal Pertandingan</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">Ã—</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label class="control-label">Player 1</label>
                            <input v-model="player_satu" type="text" name="player_1" id="" class="form-control">
                        </div>
                        <div class="form-group">
                            <label class="control-label">Player 2</label>
                            <input v-model="player_dua" type="text" name="player_2" id="" class="form-control">
                        </div>
                        <div class="form-group">
                            <label class="control-label">Tanggal/Jam</label>
                            <div class="row">
                                <div class="col-md-9">
                                    <input v-model="tanggal" type="date" name="tanggal" id="" class="form-control">
                                </div>
                                <div class="col-md-3">
                                    <input v-model="jam" type="time" name="jam" id="" class="form-control col-md-3">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label">Court No</label>
                            <input v-model="room" type="number" name="room" id="" class="form-control">
                        </div>
                    </div>
                    <div class="modal-footer justify-content-between">
                        <button class="btn btn-block btn-primary" v-on:click="simpan">Simpan</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="container well">
            <div class="mb-2">
                <button class="btn btn-success" data-toggle="modal" data-target="#modal-new">Tambah Baru</button>
            </div>
            <table class="table table-striped table-bordered table-hover">
                <thead>
                    <tr>
                        <th style="width: 10px;">No</th>
                        <th>Players</th>
                        <th class="text-center" style="width: 230px;">Tanggal/Jam</th>
                        <th style="width: 130px" class="text-center">Court No.</th>
                        <th class="text-center" style="width: 200px;">#</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="(item, index) in jadwals">
                        <td>{{index + 1}}</td>
                        <td class="text-center">
                            <span>{{item.player_satu}}</span>
                            <div style="display: flex; flex-direction: row; justify-content: center; align-items: center;">
                                <div style="border-bottom: 1px solid black;margin: 5px 0px; width: 100%;"></div>
                                <div style="margin: 6px 8px;">vs</div>
                                <div style="border-bottom: 1px solid black;margin: 5px 0px; width: 100%;"></div>
                            </div>
                            <span>{{item.player_dua}}</span>
                        </td>
                        <td class="text-center">
                            {{formatTanggal(item)}}
                        </td>
                        <td class="text-center">
                            <b style="font-size: 3rem;">#</b>
                            <b style="font-size: 5rem;">{{item.room}}</b>
                        </td>
                        <td style="text-align: right;">
                            <a style="width: 80px;" :href="'/spectate?room=' + item.room" class="btn btn-primary">Spectate</a>
                            <a style="width: 80px;" :href="'/control-room?room=' + item.room" class="btn btn-warning">Control</a>
                            <button style="width: 80px;" v-on:click="update(item)" class="btn btn-default">Update</button>
                            <button style="width: 80px;" v-on:click="hapus(item.id)" class="btn btn-danger">Hapus</button>

                            <a v-if="item.data_json != null || item.games_json != null" :href="'/hasil-pertandingan?room=' + item.id" style="width: 165px;" class="btn btn-success">Hasil Pertandingan</a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

    </div>
</body>

<script>

    const BASE_URL = "http://localhost:8080"

    const {createApp} = Vue
    const app = createApp({
        data(){
            return{
                player_satu: '',
                player_dua: '',
                room: '',
                tanggal: moment().format("YYYY-MM-DD"),
                jam: moment().format("hh:mm"),
                jadwals : [],
                id: null
            }
        },
        methods: {
            load(){
                axios.get(BASE_URL + "/api/jadwal").then((res) => {
                    console.log("res", res)
                    this.jadwals = res.data
                }).catch((err) => {
                    console.log("err", err)
                })
            },
            simpan(){
                axios.post(BASE_URL + "/api/jadwal", {
                    player_satu: this.player_satu,
                    player_dua: this.player_dua,
                    room: this.room,
                    tanggal: this.tanggal,
                    jam: this.jam,
                    id: this.id
                }).then((res) => {
                    console.log("res", res)
                    window.location.reload()
                }).catch((err) => {
                    console.log("err",err)
                })
            },
            hapus(id){
                console.log("id", id)
                axios.post(BASE_URL + "/api/jadwal/hapus", {
                    id: id
                }).then((res) => {
                    console.log("res", res)
                    window.location.reload()
                }).catch((err) => {
                    console.log("err", err)
                })
            },
            update(item){
                this.player_satu = item.player_satu
                this.player_dua = item.player_dua
                this.tanggal = moment(item.tanggal).format("YYYY-MM-DD")
                this.room = item.room
                this.id = item.id

                $("#modal-new").modal("show")
            },
            formatTanggal(item){
                let jam = item.jam
                if (item.jam == null) {
                    jam = "00:00"
                }

                let tanggal = item.tanggal.split("T")[0]
                return moment(tanggal + "T" + item.jam + ":00.000Z").format('MMMM Do YYYY') + ", " + jam;
            }
        },
        mounted(){
            this.load()
        }
    }).mount("#app")

    $(document).ready(function () {
        
    })
</script>

</html>